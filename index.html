<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Resumable Lambdas : An implementation of N4244 Resumable Lambdas">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Resumable Lambdas</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/chriskohlhoff/resumable-pp">View on GitHub</a>

          <h1 id="project_title">Resumable Lambdas</h1>
          <h2 id="project_tagline">An implementation of N4244 Resumable Lambdas</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/chriskohlhoff/resumable-pp/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/chriskohlhoff/resumable-pp/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>
<a name="resumable-lambdas-implemented-as-a-c-to-c-preprocessor" class="anchor" href="#resumable-lambdas-implemented-as-a-c-to-c-preprocessor"><span class="octicon octicon-link"></span></a>Resumable lambdas implemented as a C++-to-C++ preprocessor</h3>

<p>This project is an implementation of the C++ standards proposal <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4244.pdf">N4244 Resumable Lambdas</a>. It is implemented using LibClang and generates code suitable for compilation by recent clang and g++ compilers with <code>-std=c++1y</code> mode. Please note that there are some differences from N4244, mainly due to having to work inside the existing C++ grammar. These differences are described below.</p>

<h3>
<a name="please-be-gentle-and-dont-be-surprised-if-you-have-issues" class="anchor" href="#please-be-gentle-and-dont-be-surprised-if-you-have-issues"><span class="octicon octicon-link"></span></a>Please be gentle and don't be surprised if you have issues</h3>

<p>The preprocessor is easily confused. Avoid exotic code, for small values of exotic. For example, automatic deduction of local variable types, temporaries within an expression, nesting lambdas within lambdas, etc., are not likely to work.</p>

<h3>
<a name="try-it-out-online" class="anchor" href="#try-it-out-online"><span class="octicon octicon-link"></span></a>Try it out online</h3>

<p>You can try the preprocessor online at <a href="http://think-async.com/resumable-pp/">http://think-async.com/resumable-pp/</a>. This page will generate C++ code that you can copy and paste into your own source file.</p>

<h3>
<a name="building-from-source" class="anchor" href="#building-from-source"><span class="octicon octicon-link"></span></a>Building from source</h3>

<p>Clone or download the repository and use the included makefile. It has been tested with the clang-3.5-dev package on Debian Linux, and with Clang 3.5 built from source on Mac OS.</p>

<h3>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h3>

<p>The repository includes some simple examples and tests. You can view them online <a href="https://github.com/chriskohlhoff/resumable-pp/tree/master/test">here</a>.</p>

<h3>
<a name="differences-from-n4244" class="anchor" href="#differences-from-n4244"><span class="octicon octicon-link"></span></a>Differences from N4244</h3>

<h4>
<a name="resumable-keyword" class="anchor" href="#resumable-keyword"><span class="octicon octicon-link"></span></a>
<code>resumable</code> keyword</h4>

<p>In N4244, resumable lambdas are identified by the <code>resumable</code> keyword:</p>

<pre><code>[]() resumable
{
  yield 42;
  // ...
}
</code></pre>

<p>In this implementation this keyword is optional:</p>

<pre><code>[]
{
  yield 42;
  // ...
}
</code></pre>

<p>The preprocessor will automatically search for <code>yield</code>, <code>yield from</code> and <code>return from</code> statements within a lambda. Note that you should still use the <code>resumable</code> keyword if you want to modify a captured variable (it also marks the lambda as being <code>mutable</code>).</p>

<h4>
<a name="yield" class="anchor" href="#yield"><span class="octicon octicon-link"></span></a>yield</h4>

<p>The use of <code>yield</code> as a statement is fully supported. However, the preprocess is unable to deduce the resumable lambda's return type from just <code>yield</code>; there must be a <code>return</code> as well. If necessary, add a trailing return type:</p>

<pre><code>[]() resumable -&gt; int
{
  yield 42;
}
</code></pre>

<h4>
<a name="yield-type-id" class="anchor" href="#yield-type-id"><span class="octicon octicon-link"></span></a>yield (type-id)</h4>

<p>This has not been implemented.</p>

<h4>
<a name="yield-from" class="anchor" href="#yield-from"><span class="octicon octicon-link"></span></a>yield from</h4>

<p><code>yield from</code> may be used to delegate to a sub generator. However, the preprocessor does not yet support the use of <code>yield from</code> as an expression, i.e. it cannot do:</p>

<pre><code>int i = yield from my_generator();
</code></pre>

<h4>
<a name="return-from" class="anchor" href="#return-from"><span class="octicon octicon-link"></span></a>return from</h4>

<p><code>return from</code> does not appear in N4244. It behaves like <code>yield from</code> except that once the sub generator terminates the outer generator automatically terminates as well.</p>

<h4>
<a name="stop_iteration-and-falling-off-the-end" class="anchor" href="#stop_iteration-and-falling-off-the-end"><span class="octicon octicon-link"></span></a>stop_iteration and falling off the end</h4>

<p>The <code>stop_iteration</code> exception has not been implemented. Falling off the end is undefined behaviour, just as it is with a normal function.</p>

<h4>
<a name="this" class="anchor" href="#this"><span class="octicon octicon-link"></span></a>[]this</h4>

<p>The <code>[]this</code> expression is not supported by the C++ grammar. You may use <code>lambda_this</code> instead.</p>

<h4>
<a name="resumable-lambda-member-functions" class="anchor" href="#resumable-lambda-member-functions"><span class="octicon octicon-link"></span></a>Resumable lambda member functions</h4>

<p>The generated code for resumable lambdas will include the member functions as described in N4244, such as <code>is_terminal()</code>. However, trying to use them will typically trigger errors in the preprocessor. This is because normal lambdas do not support these function. To work around this, free functions are also provided. So, instead of writing:</p>

<pre><code>bool b = g.is_terminal();
</code></pre>

<p>write:</p>

<pre><code>bool b = is_terminal(g);
</code></pre>

<h4>
<a name="wanted" class="anchor" href="#wanted"><span class="octicon octicon-link"></span></a>wanted</h4>

<p>The <code>wanted</code> member function is provided but always returns a <code>void*</code>, as local classes cannot have template member functions.</p>

<h4>
<a name="use-of-unions-to-compress-the-resumable-lambda-object-layout" class="anchor" href="#use-of-unions-to-compress-the-resumable-lambda-object-layout"><span class="octicon octicon-link"></span></a>Use of unions to compress the resumable lambda object layout</h4>

<p>N4244 describes how unions may be used to overlap the memory associated with different local scopes. This optimisation has not yet been implemented in the preprocessor.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Resumable Lambdas maintained by <a href="https://github.com/chriskohlhoff">chriskohlhoff</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
